<!--{eval include template(TPLDIR.'header.htm',1);}--><div class="wrap"><div class="editor"><form method="post" name="thevalueform" id="thevalueform" action="$theurl" enctype="multipart/form-data"><input type="hidden" name="formhash" value="$formhash" /><div class="editor_left"><div class="titlediv"><input name="subject" placeholder="在此输入文章标题" type="text" id="subject" size="80" maxlength="80" value="$thevalue[subject]" autofocus="autofocus"/><span id="title-intro"></span> <script>function getLength(str){return str.replace(/[^\x00-xff]/g,'xx').length;}$(function(){$('#subject').keyup(function(){var a=getLength($('#subject').val());if(a>50){$('#title-intro').html('您已输入<strong>'+a+'</strong>个字符，最多可输入80个！');}else{$('#title-intro').html('');}if(a>80){$('#subject').css('background','#ff0');}else{$('#subject').css('background','');}});});</script> </div><div class="opatt"> <a href="javascript:opthis();" id="upbots"><i class="fa img-icon"></i> 上传/管理图片</a> <a href="javascript:downimg();" id="downimgbot"><i class="fa cloud-down"></i> 下载远程图片</a></div><div class="postcon"> <script src="./editor/tinymce.min.js"></script> <script>tinymce.init({selector: "textarea",language:'zh_CN',branding: false,convert_urls: false,paste_data_images: true,height:550,theme: "modern",pagebreak_split_block: true,plugins: ["autosave lists link image codesample hr pagebreak","searchreplace wordcount visualblocks visualchars code fullscreen","save table contextmenu","emoticons textcolor"],toolbar: "undo redo | formatselect bold italic forecolor backcolor | pastetext alignleft aligncenter alignright alignjustify | bullist numlist blockquote outdent indent | image link unlink emoticons codesample restoredraft code removeformat",menubar: 'edit insert view format table',link_context_toolbar: true,link_list: [{title: '$_MCONFIG[sitename]', value: '{MURL}'}<!--{loop $_MGLOBAL['category'] $value}-->,{title: '$value['name']', value: '#action/category/catid/$value['catid']#'}<!--{/loop}-->]});</script><textarea name="content">$thevalue[content]</textarea></div></div><div class="editor_right"><h2> <i class="fa paperclip"></i> 文章设置</h2><p><strong>分类选择：</strong><select name="catid" class="select"><!--{loop $categorylistarr $value}--><option value="$value[catid]"<!--{if $thevalue[catid]==$value[catid]}--> selected<!--{/if}-->>$value[name]</option><!--{/loop}--></select></p><p><input type="text" name="posttime" value="$thevalue[thisdata]" class="theinput"><strong>修改时间:</strong></p><p id="qtag"><input name="tags" placeholder="关键字1,关键字2" type="text" class="theinput" size="20" value="$thevalue[tags]" /><strong>TAG: <i class="fa question"></i></strong><span>标签(TAG)一般为文章的关键字，有助于SEO及前台文章的调用显示，多个标签请用英文的逗号(,)或空格隔开。</span></p><p id="qurl"><input name="url" placeholder="拼音或者英文" type="text" class="theinput" size="20" value="$thevalue[url]" /><strong>Url: <i class="fa question"></i></strong><span>效果：{MURL}/分类url/<strong style="color:red">输入项</strong>-文章ID.html</span></p><p id="grade"><strong style="width:100px">文章等级: <i class="fa question"></i></strong><select class="select" name="grade"><option value="0"<!--{if $thevalue[grade]==0}--> selected="selected"<!--{/if}-->>不设置等级</option><!--{eval $i=1}--><!--{loop $checkgrade $value}--><option value="$i"<!--{if $thevalue[grade]==$i}--> selected="selected"<!--{/if}-->>$value</option><!--{eval $i++}--><!--{/loop}--></select><span>等级名称可以在系统设置里修改，选择等级后可以更灵活的调用文章及控制文章的显示方式。</span> </p><p><input name="digest" type="checkbox"  class="checkbox" value="1"<!--{if $thevalue[digest]}--> checked="checked"<!--{/if}-->> <strong><i class="fa digest"></i> 设置为精华</strong></p><p><input name="top" type="checkbox"  value="1" class="checkbox"<!--{if $thevalue[top]}--> checked="checked"<!--{/if}-->> <strong><i class="fa topico"></i> 置顶本文章</strong></p><p><input name="allowreply" type="checkbox" class="checkbox"  value="1"  checked="checked"><strong><i id="comment" class="fa"></i> 允许评论</strong></p><p><input type="submit" name="valuesubmit" value="提交保存 & 发布文章" onclick="return check(this.form);" class="setsubmint"><input name="id" type="hidden" value="$thevalue[id]" /><input name="nid" type="hidden" value="$thevalue[nid]" /><input name="hash" type="hidden" value="$thevalue[hash]" /></p><script>$(function(){$('#qtag i').mouseover(function(){$('#qtag span').show();});$('#qtag i').mouseout(function(){$('#qtag span').delay(500).hide(0);});$('#qurl i').mouseover(function(){$('#qurl span').show();});$('#qurl i').mouseout(function(){$('#qurl span').delay(500).hide(0);});$('#grade i').mouseover(function(){$('#grade span').show();});$('#grade i').mouseout(function(){$('#grade span').delay(500).hide(0);});});</script> </div></form><div class="clear"></div></div></div><div class="uploadimg"><a href="javascript:clthis();" class="close-reveal-modal right">×</a><div class="upboton"> <span class="fileinput-button"> <span><i class="fa plusup"></i> 点击从本地上传的文件</span><form><input id="fileupload" type="file" accept="image/png,image/gif,image/jpg,image/jpeg" name="files" multiple><input name="hash" type="hidden" value="$thevalue[hash]" /></form></span><div id="progress" class="progress"><div class="progress-bar"><!-- 进度条 --></div></div><div class="clear"></div></div><div class="meadia"><!--{if !empty($attunuse)}--><!--{if $imguserid==0}--><dl class="att attmor"><script>$(function () {$('#upbots').append(' <i class="fa nouse" title="您还有上传后未使用的图片，24小时后将会自动删除！"></i>');});</script><dt>您还有上传后未使用的图片，24小时后将会自动删除！</dt><!--{else}--><dl class="att"><!--{/if}--> <!--{loop $attunuse $value}--><dd id="imgdd$value[aid]"><img src="$value[url]" /><input name="url[]" type="checkbox" value="{$value[url]}|{$value[aid]}" /><a href="javascript:delimg('$value[aid]');" onclick="return confirm('您将彻底删除本图片，单击“确定”继续。单击“取消”停止。')">删除</a></dd><!--{/loop}--><div class="clear"></div></dl><!--{/if}--><div id="files" class="files"><dl><!-- 上传完后图片显示区域 --></dl></div><div class="clear"></div><div class="media-toolbar"><a href="javascript:insertCon();" class="setsubmint">选中项插入至文章</a></div></div><script src="./static/jquery.ui.widget.js"></script><script src="./static/jquery.fileupload.js"></script></div><script>function clthis(){$('.uploadimg').hide();}function opthis(){$('.uploadimg').show();}$(function(){$('#fileupload').fileupload({url: '{CPURL}?action-upload',dataType: 'json',done:function(e,data){var file=data.result;if(typeof(file.url)!="undefined"){tinymce.execCommand('mceInsertContent',false,'<p><img src="'+file.url+'" /></p>');$('#files').append('<dd id="imgdd' + file.id + '"><img src="' + file.url + '" alt="'+file.fileName+'" /><input name="url[]" type="checkbox" checked="checked" value="' + file.url + '" /><a href="javascript:delimg(\''+file.id+'\');" onclick="return confirm(\'您将彻底删除本图片，单击“确定”继续。单击“取消”停止。\')">删除</a></dd>');$('#thevalueform').append('<input name="attnew[]" type="hidden" value="' + file.id + '" />');$('.uploadimg').hide();}else{alert('错误提示：'+file.error);}},progressall: function (e,data) {var progress = parseInt(data.loaded/data.total*100,10);$('#progress .progress-bar').css('width',progress + '%');}}).prop('disabled', !$.support.fileInput).parent().addClass($.support.fileInput ? undefined : 'disabled');});function delimg(v){var thisimgid='#imgdd'+v;$.get("{CPURL}?action-attachments-delete-"+v,function(data,status){if(status=='success'){$(thisimgid).html('<span>' + data + '</span>');  setTimeout(function(){$(thisimgid).remove();},1500);}else{alert('删除失败，原因：'+status);}});}function insertCon(){var arr;$('.meadia :input').each(function(){  if($(this).is(':checked')) {arr = $(this).val().split('|');tinymce.execCommand('mceInsertContent',false,'<p><img src="' + arr[0] + '" /></p>');$('#thevalueform').append('<input name="attnew[]" type="hidden" value="' + arr[1] + '" />')}}); $('.uploadimg').hide(); }function downimg(){$('#downimgbot').text('正在下载中...请稍后...');var condata=tinyMCE.get('content').getContent();$.post('{CPURL}?action-upload',{content:condata,formhash:'$formhash',hash:'$thevalue[hash]',ajaxsubmit:true},function(data,status){if(status == 'success'){tinyMCE.get('content').setContent(data);$('#downimgbot').html('<i class="fa circle-yes"></i> 远程图片已成功下载...');}else{$('#downimgbot').html('<i class="fa error-icon"></i> 对不起，下载失败...');alert('远程图片下载失败原因：\n'+status+'(可能是没有需要下载的图片)');}setTimeout(function(){$('#downimgbot').html('<i class="fa cloud-down"></i> 下载远程图片');},15000);})}function check(form){if(form.subject.value=='') {alert("标题长度(2~80字符)不符合要求!");form.subject.focus();return false;}if(form.catid.value==''){alert("请选择分类!");form.catid.focus();return false;}if(tinyMCE.get('content').getContent()==''){alert("请输入文章内容!");return false;}return true;}</script><!--{eval include template(TPLDIR.'footer.htm',1);}-->